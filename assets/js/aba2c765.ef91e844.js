"use strict";(self.webpackChunkfrontendcourse=self.webpackChunkfrontendcourse||[]).push([[9346],{3719:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/persons2-9f2e95ecbfb4666a96c94d5cf3a83678.png"},3753:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/networking-95268744a0373acc105e7b5c8d09b737.png"},4245:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/api_response-00c9d478f2433978498debd6b76f3e41.png"},6657:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/persons-7349593fe1d82d117047b51f96dfb12f.png"},6738:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"networking/listhandling","title":"User list example","description":"User lists","source":"@site/docs/networking/listhandling.md","sourceDirName":"networking","slug":"/networking/listhandling","permalink":"/frontendprogramming/docs/networking/listhandling","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"User list example","sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Nasa example","permalink":"/frontendprogramming/docs/networking/fetchexample"},"next":{"title":"Env Variables","permalink":"/frontendprogramming/docs/networking/env"}}');var r=s(4848),i=s(8453);const o={title:"User list example",sidebar_position:5},a=void 0,c={},d=[{value:"User lists",id:"user-lists",level:3},{value:"Typing fetch &amp; Refactoring",id:"typing-fetch--refactoring",level:3}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h3:"h3",img:"img",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h3,{id:"user-lists",children:"User lists"}),"\n",(0,r.jsxs)(n.p,{children:["The next example fetches an array of user objects from the REST API and store it to React state. The REST API to be used is ",(0,r.jsx)(n.strong,{children:"Reqres.in"})," fake API, and the following URL returns a list of fake users (",(0,r.jsx)(n.a,{href:"https://reqres.in/api/users",children:"https://reqres.in/api/users"}),")."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Persons example",src:s(6657).A+"",width:"568",height:"337"})}),"\n",(0,r.jsx)(n.p,{children:"Let's define a type for the user object:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"type User = {\n  id: number;\n  email: string;\n  first_name: string;\n  last_name: string;\n  avatar: string;\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["We need an array to store a list of users; therefore, we create a state called ",(0,r.jsx)(n.code,{children:"users"})," and initialize that to an empty array. Then, we use the ",(0,r.jsx)(n.code,{children:"useEffect"})," hook to send a request once after the first render."]}),"\n",(0,r.jsxs)(n.p,{children:["Reqres.in requires an API key to be included in the request headers, which you can get for free. To add headers to your request, use the second argument of the ",(0,r.jsx)(n.code,{children:"fetch"})," function and specify the ",(0,r.jsx)(n.code,{children:"headers"})," property. You can find header in ",(0,r.jsx)(n.a,{href:"https://reqres.in/signup",children:"https://reqres.in/signup"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const [users, setUsers] = useState<User[]>([]);\n\nuseEffect(() => {\n  fetch('https://reqres.in/api/users', {\n    headers: { 'x-api-key': 'reqres-free-v1' }\n  })\n  .then(response => {\n    if (!response.ok)\n      throw new Error(\"Error in fetch: \" + response.statusText);\n  \n    return response.json();\n  })\n  .then(responseData => setUsers(responseData.data))\n  .catch(err => console.error(err))\n}, [])\n"})}),"\n",(0,r.jsxs)(n.admonition,{type:"warning",children:[(0,r.jsxs)(n.p,{children:["Including API keys directly in your frontend code, like this is not recommended, as it exposes sensitive credentials. Even environment variables in frontend builds (like ",(0,r.jsx)(n.code,{children:"VITE_API_KEY"}),") are still visible to users."]}),(0,r.jsx)(n.p,{children:"Use instead a backend proxy Create a small backend server (e.g., with Node.js/Express). This server can securely store the API key and make the request to the external API. Your frontend then makes requests to your own backend, which adds the API key securely."}),(0,r.jsx)(n.p,{children:"You can also use frameworks such as Next.js where you can make network requests in server side."})]}),"\n",(0,r.jsxs)(n.p,{children:["Now, if you open the developer console in your browser and navigate to the ",(0,r.jsx)(n.strong,{children:"Network"})," tab, you can see the requests made by the component. You will find the ",(0,r.jsx)(n.code,{children:"users"})," request triggered by our component. The response payload is also displayed in the console. You might notice that the ",(0,r.jsx)(n.code,{children:"users"})," request is executed twice. This behavior is due to ",(0,r.jsx)(n.code,{children:"React.StrictMode"})," that is enabled in the ",(0,r.jsx)(n.code,{children:"main.tsx"})," file. ",(0,r.jsx)(n.code,{children:"React.StrictMode"})," invokes certain lifecycle methods twice during development to help identify potential issues. This behavior is specific to the development environment and will not occur in the production build of your application."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Network console",src:s(3753).A+"",width:"1065",height:"609"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"return"})," statement looks the following. Each user object includes a unique ",(0,r.jsx)(n.code,{children:"id"}),", which is used as the ",(0,r.jsx)(n.code,{children:"key"})," for each table row:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"return (\n  <>\n    <h2>Users</h2>\n    <table>\n      <thead>\n        <tr>\n          <th>First Name</th>\n          <th>Last Name</th>\n          <th>Email</th>\n        </tr>\n      </thead>\n      <tbody>\n        {users.map((user: User) => (\n          <tr key={user.id}>\n            <td>{user.first_name}</td>\n            <td>{user.last_name}</td>\n            <td>{user.email}</td>\n          </tr>\n        ))}\n      </tbody>\n    </table>\n  </>\n)\n"})}),"\n",(0,r.jsx)(n.p,{children:"Now, the list should look like the following screenshot:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:s(3719).A+"",width:"610",height:"405"})}),"\n",(0,r.jsx)(n.h3,{id:"typing-fetch--refactoring",children:"Typing fetch & Refactoring"}),"\n",(0,r.jsx)(n.p,{children:"We can define types to represent the structure of the API response. Next, we will learn how to perform type-safe fetching using the same Reqres.in REST API as before."}),"\n",(0,r.jsx)(n.p,{children:"The response data looks the following:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "page": 1,\n  "per_page": 6,\n  "total": 12,\n  "total_pages": 2,\n  "data": [\n    {\n      "id": 1,\n      "email": "george.bluth@reqres.in",\n      "first_name": "George",\n      "last_name": "Bluth",\n      "avatar": "https://reqres.in/img/faces/1-image.jpg"\n    },\n    {\n      "id": 2,\n      "email": "janet.weaver@reqres.in",\n      "first_name": "Janet",\n      "last_name": "Weaver",\n      "avatar": "https://reqres.in/img/faces/2-image.jpg"\n    },\n    {\n      "id": 3,\n      "email": "emma.wong@reqres.in",\n      "first_name": "Emma",\n      "last_name": "Wong",\n      "avatar": "https://reqres.in/img/faces/3-image.jpg"\n    },\n  ],\n  "support": {\n    "url": "https://contentcaddy.io?utm_source=reqres&utm_medium=json&utm_campaign=referral",\n    "text": "Tired of writing endless social media content? Let Content Caddy generate it for you."\n  }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"We need to define a type to represent the structure of the REST API response:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"export type ApiResponse = {\n  page: number;\n  per_page: number;\n  total: number;\n  total_pages: number;\n  data: User[];\n  support: {\n    url: string;\n    text: string;\n  }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["We can define the ",(0,r.jsx)(n.code,{children:"responseData"})," with the ",(0,r.jsx)(n.code,{children:"ApiResponse"})," type to ensure type safety:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"useEffect(() => {\n  fetch(\"https://reqres.in/api/users\", {\n    headers: { 'x-api-key': 'reqres-free-v1' }\n  })\n  .then((response) => {\n    if (!response.ok) throw new Error(`Error in fetch: ${response.status}`)\n\n    return response.json()\n  })\n  //highlight-next-line\n  .then((responseData: ApiResponse) => setUsers(responseData.data))\n  .catch((err) => console.error(err))\n}, [])\n"})}),"\n",(0,r.jsx)(n.p,{children:"Additionally, we can create own module to handle REST API functions. This approach is beneficial when the same request needs to be made in multiple components, as it avoids code duplication. It also simplifies REST API testing which is commonly made by mocking."}),"\n",(0,r.jsxs)(n.p,{children:["To improve reusability and maintainability, define the types in a separate module and export them for use in other parts of the application. you can also create a dedicated module (e.g., ",(0,r.jsx)(n.code,{children:"userApi.ts"}),") to handle REST API interactions. In this approach, API logic is easier to manage and test."]}),"\n",(0,r.jsxs)(n.p,{children:["For example, you can define and export the ",(0,r.jsx)(n.code,{children:"User"})," and  ",(0,r.jsx)(n.code,{children:"ApiResponse"})," types in a ",(0,r.jsx)(n.code,{children:"types.ts"})," file:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="types.ts"',children:"export type User = {\n  id: number;\n  email: string;\n  first_name: string;\n  last_name: string;\n  avatar: string;\n}\n\nexport type ApiResponse = {\n  page: number;\n  per_page: number;\n  total: number;\n  total_pages: number;\n  data: User[];\n  support: {\n    url: string;\n    text: string;\n  };\n};\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Then, in the ",(0,r.jsx)(n.code,{children:"userApi.ts"})," module, handle the API request logic:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import { ApiResponse } from \"./types\";\n\nexport const fetchUsers = (): Promise<ApiResponse> => {\n  return fetch(\"https://reqres.in/api/users\", {\n    headers: { 'x-api-key': 'reqres-free-v1' }\n  })\n  .then((response) => {\n    if (!response.ok) {\n      throw new Error(`Error in fetch: ${response.status}`);\n    }\n    return response.json();\n  });\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"fetchUsers"})," function returns a ",(0,r.jsx)(n.code,{children:"Promise"}),". We can use generics to define value that Promise resolves and in our case it is ",(0,r.jsx)(n.code,{children:"ApiResponse"}),". That's why function's return type is ",(0,r.jsx)(n.code,{children:"Promise<ApiResponse>"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["When the ",(0,r.jsx)(n.code,{children:"Promise"})," resolves, the resolved value will match the structure defined by the ",(0,r.jsx)(n.code,{children:"ApiResponse"})," type. If you try to access properties on the resolved value that are not part of ",(0,r.jsx)(n.code,{children:"ApiResponse"}),", TypeScript will throw a compile-time error."]}),"\n",(0,r.jsxs)(n.p,{children:["Now, developers know exactly what to expect when the ",(0,r.jsx)(n.code,{children:"Promise"})," resolves. You can also get autocompletion support for the ApiResponse type when type is defined."]}),"\n",(0,r.jsxs)(n.p,{children:["Then, we can use ",(0,r.jsx)(n.code,{children:"fetchUsers"})," function in ",(0,r.jsx)(n.code,{children:"UserList"})," component."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"useEffect(() => {\n  fetchUsers()\n  .then(responseData => setUsers(responseData.data))\n  .catch(err => console.error(err))\n}, [])\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Now, you can see the TypeScript error if you try to access properties that doesn't exist in ",(0,r.jsx)(n.code,{children:"ApiResponse"}),". You will also get autocompletion as shown in the following image:"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Autocompletion example",src:s(4245).A+"",width:"933",height:"344"})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["You can also create custom hook to perform REST API call. Read more about custom hooks in ",(0,r.jsx)(n.a,{href:"https://react.dev/learn/reusing-logic-with-custom-hooks",children:"https://react.dev/learn/reusing-logic-with-custom-hooks"}),"."]})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var t=s(6540);const r={},i=t.createContext(r);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);